================================================================================
        SISTEMA DE NAVEGACI√ìN PRO: "DRIVE & RECORD" (PASO A PASO)
================================================================================

Este sistema te permite grabar tus propias rutas conduciendo y luego 
reproducirlas de forma aut√≥noma con precisi√≥n profesional.

REQUISITO PREVIO (En tu PC / Host):
  xhost +local:

================================================================================
        FASE 1: GRABAR UNA RUTA (üé• RECORDING)
================================================================================

Sigue este orden de terminales (ejecutados desde el host en la ra√≠z del proyecto):

--- TERMINAL 1: Lanzar QLabs ---
./run_t1.sh

--- TERMINAL 2: Lanzar Cartographer (SLAM) ---
./run_t2.sh

--- TERMINAL 3: Nodo Grabador ---
# Entrar al contenedor
./isaac_ros_common/scripts/run_dev.sh ./Development -- bash
cd /workspaces/isaac_ros-dev/ros2 && source install/setup.bash

# Grabar con un nombre personalizado
./record.sh vuelta_pro_3

--- TERMINAL 4: Control con teclado ---
# NOTA: Si sale "Package not found", ejecuta colcon build primero.
./isaac_ros_common/scripts/run_dev.sh ./Development -- bash

# DENTRO DEL CONTENEDOR:
cd /workspaces/isaac_ros-dev/ros2
colcon build --packages-select qcar2_autonomy   # ‚Üê Asegura que ROS encuentre el paquete
source install/setup.bash                       # ‚Üê "Activa" el paquete en esta terminal
ros2 run qcar2_autonomy simple_teleop_keyboard

--------------------------------------------------------------------------------
FINALIZAR GRABACI√ìN: 
  Cuando termines la vuelta, ve a la TERMINAL 3 y pulsa Ctrl+C.
  La ruta se guardar√° en: routes/vuelta_pro_1.json
--------------------------------------------------------------------------------

================================================================================
        FASE 2: REPRODUCIR RUTA (üèéÔ∏è NAVIGATION)
================================================================================

Si ya tienes T1 y T2 corriendo de la fase anterior, solo necesitas la T3.

--- TERMINAL 3: Navegaci√≥n Aut√≥noma ---
# Entrar al contenedor (si no est√°s dentro)
./isaac_ros_common/scripts/run_dev.sh ./Development -- bash
cd /workspaces/isaac_ros-dev/ros2

# Compilar por si hubo cambios y activar ROS
colcon build --packages-select qcar2_autonomy && source install/setup.bash

# Opci√≥n A: Reproducci√≥n Est√°ndar
./navigate.sh routes/vuelta_pro_3.json

# Opci√≥n B: Con "Skip" (curvas m√°s suaves, usa 1 de cada 5 puntos)
./navigate.sh routes/vuelta_pro_1.json 5

# Opci√≥n C: Loop Infinito (dar vueltas sin parar)
./navigate.sh routes/vuelta_pro_1.json 1 true

================================================================================
        MODO H√çBRIDO: CARGAR RUTA + EDITAR EN RVIZ
================================================================================

Este modo carga una ruta grabada en el editor de RViz para que puedas verla,
a√±adirle m√°s puntos con "Publish Point" y luego enviarla al coche.

--- Terminal 3: Lanzar Editor cargando tu ruta ---
# 1. (DENTRO DEL CONTENEDOR) Compilar con dependencias de interfaces
cd /workspaces/isaac_ros-dev/ros2
colcon build --packages-up-to qcar2_autonomy && source install/setup.bash

# 2. Lanzar el editor (puedes usar el JSON simplificado o el completo)
ros2 launch qcar2_autonomy waypoint_rviz_launch.py \
  load_file:=/workspaces/isaac_ros-dev/ros2/routes/vuelta1_waypoints.json

--- En RViz ---
  1. Ver√°s los puntos de la grabaci√≥n aparecer autom√°ticamente (AMARILLOS).
  2. Usa la herramienta "Publish Point" (arriba en RViz) para a√±adir M√ÅS puntos 
     donde quieras extender o ajustar la ruta.
  3. Para enviar todo al coche y que empiece a moverse:
     ros2 service call /send_path std_srvs/srv/Empty

================================================================================
        MODO CALCA: USAR GRABACI√ìN COMO GU√çA (TRACE MODE)
================================================================================

Este es el modo m√°s PRO: ves tu grabaci√≥n en VERDE (como un fantasma) y pones 
tus waypoints AMARILLOS encima calzando la ruta perfecta.

--- Terminal 3: Lanzar con Gu√≠a de Referencia ---
ros2 launch qcar2_autonomy waypoint_rviz_launch.py \
  reference_file:=/workspaces/isaac_ros-dev/ros2/routes/vuelta_pro_1.json

--- En RViz ---
  1. Ver√°s la estela de tu grabaci√≥n en VERDE trasl√∫cido.
  2. Pon tus puntos AMARILLOS usando "Publish Point" siguiendo la estela verde.
  3. Manda al coche: ros2 service call /send_path std_srvs/srv/Empty
  4. üèÅ ¬°EL COCHE SE PARAR√Å SOLO AL LLEGAR AL √öLTIMO PUNTO AMARILLO!

================================================================================
        DUDAS Y TRUCOS
================================================================================

1. ¬øQu√© se ve en RViz?
   - Fondo oscuro con rejilla sutil (sin imagen de pista).
   - Gu√≠a de referencia: L√çNEA VERDE ne√≥n con esferas verdes + flechas de direcci√≥n.
   - Waypoints activos: ESFERAS √ÅMBAR con l√≠nea amarilla + flechas de direcci√≥n.
   - Marcador de inicio: CILINDRO AZUL en el primer punto.
   - Marcador de meta: CILINDRO ROJO en el √∫ltimo punto.

2. ¬øC√≥mo borrar todo y empezar de cero?
   - Ctrl+C en todas las terminales.
   - Si quieres borrar los puntos grabados en el grabador sin cerrar: 
     ros2 service call /clear_waypoints std_srvs/srv/Empty

3. ¬øD√≥nde est√°n mis archivos de ruta?
   - En la carpeta: routes/ (dentro de ros2/)

4. Recompilar (Obligatorio tras cambiar c√≥digo .py):
   # Usamos --packages-up-to para compilar tambi√©n las interfaces necesarias
   colcon build --packages-up-to qcar2_autonomy && source install/setup.bash
